<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finder AI - Report Lost Item</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <!-- External CSS -->
  <link rel="stylesheet" href="styles/claimitem.css">
</head>
<body>
  <nav>
    <ul>
      <li><a href="index.html">HOME</a></li>
      <li><a href="#about">ABOUT</a></li>
      <li><a href="#logout">LOG OUT</a></li>
      <li><a href="#contact">CONTACT US</a></li>
      <li><a href="#help">HELP</a></li>
    </ul>
  </nav>

  <section class="lostfile-section">
    <h2>Report a Lost Item</h2>
    <form id="lostItemForm" enctype="multipart/form-data">
      <input type="file" accept="image/*" id="lostImageInput" name="image" required>
      <label for="lostImageInput">Upload Image of Lost Item</label>

      <label for="categorySelect">Category:</label>
      <select id="categorySelect" name="category" required>
        <option value="">Select Category</option>
        <option value="Wallet">Wallet</option>
        <option value="Phone">Phone</option>
        <option value="Keys">Keys</option>
        <option value="Bag">Bag</option>
        <option value="ID">ID/Card</option>
        <option value="Electronics">Electronics</option>
        <option value="Jewelry">Jewelry</option>
        <option value="Other">Other</option>
      </select>

      <label for="locText">Location Last Seen:</label>
      <textarea id="locText" name="location" rows="3" placeholder="e.g., Mapua Cafeteria, near entrance" required></textarea>

      <label for="descText">Description:</label>
      <textarea id="descText" name="description" rows="3" placeholder="Describe your lost item (color, brand, unique features, etc.)" required></textarea>

      <label for="claimerText">Your Name:</label>
      <textarea id="claimerText" name="claimerName" rows="1" placeholder="Full Name" required></textarea>

      <label for="schoolEmail">School Email:</label>
      <input type="email" id="schoolEmail" name="schoolEmail" placeholder="your.name@mymail.mapua.edu.ph" required>

      <label for="schoolID">School ID:</label>
      <input type="text" id="schoolID" name="schoolID" placeholder="e.g., 2022100123" required>

      <button type="submit" class="submitbtn">Submit Lost Item</button>
    </form>
  </section>

  <div id="popup" class="popup">
  <div class="popup-content">
    <p>We'll send you a confirmation shortly.</p>
    <button id="closePopup">OK</button>
  </div>
</div>

  <script>
  const form = document.getElementById("lostItemForm");
  const popup = document.getElementById("popup");
  const closePopupBtn = document.getElementById("closePopup");

  form.addEventListener("submit", async function(event) {
    event.preventDefault();
    
    const formData = new FormData();
    formData.append('type', 'lost'); // This is a LOST item
    formData.append('category', document.getElementById('categorySelect').value);
    formData.append('location', document.getElementById('locText').value);
    formData.append('description', document.getElementById('descText').value);
    formData.append('image', document.getElementById('lostImageInput').files[0]);
    
    try {
      const response = await fetch('/api/items/upload', {
        method: 'POST',
        body: formData
      });
      
      const data = await response.json();
      
      if (response.ok) {
        popup.style.display = "flex"; // show popup
      } else {
        alert('Error: ' + data.message);
      }
    } catch (error) {
      alert('Error submitting form: ' + error.message);
    }
  });

  closePopupBtn.addEventListener("click", function() {
    popup.style.display = "none"; // hide popup
    form.reset();
    window.location.href = 'index.html'; // Go back to homepage
  });
</script>

</body>
</html>